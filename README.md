# Replication package
## Price Floors and Employer Preferences: Evidence from a Minimum Wage Experiment
by John Horton

This document describes the organization of code, data, and software associated with the project.
The code for this replication package is at: [https://www.github.com/johnjosephhorton/minimum_wage.git](https://www.github.com/johnjosephhorton/minimum_wage.git)


## Overview
This project is largely self-documenting in the sense that the key recipes for building the project are captured in code. 
The key pieces for replicating this project are: 

1. A [Makefile](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/Makefile) that gives recipes for how each figure, table, and called-out number is constructed in the paper.

1. A [Dockerfile](Dockerfile) that describes the system set-up needed with respect to computing resources and packages. 

### File organization

The main directories are:
```
-writeup
-analysis
-computed_objects
-data_prep
```

The main writeup of the paper is in [`writeup/minimum wage.tex`](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/minimum_wage.tex).

The figures, tables, and parameter files (more on this later) are in `writeup/plots`, `writeup/tables` and `writeup/parameters`, respectively.

The code in [`analysis`]( https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis ) writes files to these locations. 
In the git repository, these locations are empty by design.
When the project is built, these locations are populated with the necessary files. 

### Conventions
Each main figure and table is generated by its own stand-alone R file in `analysis` folder. 
The output that the file creates (e.g., a table or plot) has the same name as the R file, with the type of output prepended. 
For example, the plot `any_exper.pdf` in `writeup/plots` is created by `plot_any_exper.R` in `analysis.`

### Building the paper
The building of this paper is orchestrated by software called ``[make](https://www.gnu.org/software/make/manual/make.html)''.
From the `writeup` folder at the command line, the user simply types `make minimum wage.pdf` which will then build the paper.

```bash
git clone git@github.com:johnjosephhorton/minimum_wage.git
cd minimum_wage/writeup
cp ~/Downloads/.env . 
```

```bash
make docker
```

### A short make tutorial
A Makefile lists recipes for how a particular output used in the paper is constructed.
The Makefile entry for the any_exper.pdf figure looks like this: 

```Makefile
plots/cool_stuff.pdf: ../analysis/plot_cool_stuff.R  ../data/cool_data.csv
	cd ../analysis && Rscript plot_cool_stuff.R
```

Note that the target, or output is `plots/cool_stuff.pdf` 
After the colon is what this output depends on, code-wise, which is an R file in `analysis` called `plot_cool_stuff.R`.
The tabbed-in-line below is the recipe for how the target is constructed. 
In this case, it is just by running `Rscript` on `plot_cool_stuff.R.`

There is some code that is shared across multiple figures or tables in this repository. 
For example, `utilities_outcome_experimental_plots.R` has helper functions used in several plots.
To capture this dependency, there are entries in the Makefile that look like this: 

```Makefile
../analysis/plot_any_exper.R: ../analysis/utilities_outcome_experimental_plots.R
	touch ../analysis/plot_any_exper.R
```
The command `touch` here updates the timestamp of `analysis\plot_any_exper.R` which in turn 
would cause the recipe for `any_exper.pdf` to be re-run, as `plot_any_exper.R` is a dependency.

### Numbers called out in the writeup
There is also code that does not generate tables for figures, but instead generates "parameters."
These are numbers that are called out in the text but are generated automatically. 
For example, the `parameters/parameters.tex` file contains a line `\newcommand{\numTotal}{159,656}` that is related to the total allocation to the experiment.
If we look in `parameters.R` we see the corresponding code that creates this value.
```R
addParam("\\numTotal", formatC(dim(df.mw.first)[1], big.mark = ","))
```

This `addParam` function comes from a personal R package called `JJHmisc` that is available on GitHub.

## Data Availability and Provenance Statements

### Provenance

This data comes from a large online labor market that conducted the experiment described in the paper. The data was pulled from the company's database using SQL. The experiment described in the paper was conducted by the platform by changing the experience for some subset of users.  The data used for this analysis is proprietary.

### Statement about Rights

- [X] I certify that the author(s) of the manuscript have legitimate access to and permission to use the data used in this manuscript. 

- [ ] I certify that the author(s) of the manuscript have documented permission to redistribute/publish the data contained within this replication package. Appropriate permission are documented in the [LICENSE.txt](LICENSE.txt) file.

### Summary of Availability

- [ ] All data **are** publicly available.
- [ ] Some data **cannot be made** publicly available.
- [X] **No data can be made** publicly available.


### Details on each Data Source

The data for this project are confidential, but may likely be obtained with Data Use Agreements with the data provider. 
The data provider itself chooses to remain anonymous.
As such, researchers interested in access to the data may contact John Horton at jjhorton@mit.edu. 
The author will assist with any reasonable replication attempts for two years following publication.
All data files are CSVs. 

# Dataset list
The paper uses the following datasets: 

## `event_study_hired_applicants_with_past_avg_wage.csv`
Description: Individual-level details on the workers hired before and after platform-wide change.

## `df_mw_first.csv`

| Column | Description | Sample Value |
|-----|-------|------------------|
| economic_opening | X | 203338482 |
| team | X | 494815 |
| first_opening | X | 203338482 |
| opening_date | X | 2013-12-01 19:01:32 |
| num_hires | X | 0 |
| num_organic_applications | X | 10 |
| level1 | X | Web Development |
| level2 | X | Web Programming |
| url | X | http://www.odesk.com/jobs/~~fe9764e73eba6bf2 |
| job_desc_length | X | 168 |
| job_type | X | Hourly |
| contractor_tier | X | 2 |
| employer | X | 494815 |
| prior_spend | X | 79.2 |
| total_charge | X | 0 |
| hours_30d | X | 0 |
| hours | X | 0 |
| mean_wage_over_contract | X | NA |
| average_feedback_to_contractor | X | NA |
| average_feedback_to_client | X | NA |
| duration | X | NA |
| team_hours | X | 24 |
| team_hours_30day | X | 0 |
| hires | X | 0 |
| hired_past_y | X | NA |
| hired_pr | X | NA |
| tier | X | standard |
| min.wage | X | 0 |
| cell | X | 0 |
| hourly | X | TRUE |
| start | X | FALSE |
| kpo | X | FALSE |
| filled | X | FALSE |
| lwage.hat | X | 2.37022388952545 |
| avg.wage | X | NA |
| level1.median.wage | X | 10.1907272727273 |
| first.opening | X | 203338482 |
| num.openings | X | 1 |
| rr | X | 1 |
| hired.past.w | X | NA |
| markup | X | NA |


| Column | Description | Sample Value |
|-----|-------|
| economic_opening |  | 203338482 |
| team |  | 494815 |
| first_opening |  | 203338482 |
| opening_date |  | 2013-12-01 19:01:32 |
| num_hires |  | 0 |
| num_organic_applications |  | 10 |
| level1 |  | Web Development |
| level2 |  | Web Programming |
| url |  | http://www.odesk.com/jobs/~~fe9764e73eba6bf2 |
| job_desc_length |  | 168 |
| job_type |  | Hourly |
| contractor_tier |  | 2 |
| employer |  | 494815 |
| prior_spend |  | 79.2 |
| total_charge |  | 0 |
| hours_30d |  | 0 |
| hours |  | 0 |
| mean_wage_over_contract |  | NA |
| average_feedback_to_contractor |  | NA |
| average_feedback_to_client |  | NA |
| duration |  | NA |
| team_hours |  | 24 |
| team_hours_30day |  | 0 |
| hires |  | 0 |
| hired_past_y |  | NA |
| hired_pr |  | NA |
| tier |  | standard |
| min.wage |  | 0 |
| cell |  | 0 |
| hourly |  | TRUE |
| start |  | FALSE |
| kpo |  | FALSE |
| filled |  | FALSE |
| lwage.hat |  | 2.37022388952545 |
| avg.wage |  | NA |
| level1.median.wage |  | 10.1907272727273 |
| first.opening |  | 203338482 |
| num.openings |  | 1 |
| rr |  | 1 |
| hired.past.w |  | NA |
| markup |  | NA |


## `event_study_hired_applicants.csv`
Description: Individual-level details on the workers hired before and after platform-wide change.

## `event_study_windows_hr_v_fp.csv`
Description: Composition of fixed price versus hourly jobs after the platform-wide change

## `event_study_windows.csv`
Description: 

## `event_study_openings_raw.csv`
Description: 

## `JobTitles.txt`
Description: 

## `hires_country_composition.csv`
Description: 

`event_study_openings.csv`
Description: All job openings posted before and after platform-wide change.

## Codebooks

## `event_study_hired_applicants_with_past_avg_wage.csv`
    
## `df_mw_first.csv`
    
Column: first_opening: 
Column description: ID for the job opening.

Column: opening_date: 
Column description: The date when the job opening was posted.

Column: num_organic_applications: 
Column description: Number of applications received organically (i.e., not recruited).

Column: level1: 
Column description: High-level category of the job, e.g., IT, sales, etc.

Column: job_type: 
Column description: Hourly or fixed price

Column: employer: 
Column description: ID for The company or individual offering the job.

Column: total_charge: 
Column description: The total amount paid to a hired worker

Column: hours: 
Column description: The number of hours-worked.

Column: mean_wage_over_contract: 
Column description: Average wage over the contract period.

Column: average_feedback_to_contractor: 
Column description: Average feedback score given to the contractors by the employer.

Column: average_feedback_to_client: 
Column description: Average feedback score given to the employer by the contractors.

Column: hires: 
Column description: Number of hires made from the job posting.

Column: hired_past_y: 
Column description: Productivity of hired worker in the past.

Column: hired_pr: 
Column description: Hired worker profile rate.

Column: cell: 
Column description: Experimental cell cell assignment.

Column: kpo: 
Column description: Indicator for Knowledge Process Outsourcing.

Column: lwage.hat: 
Column description: A predicted log-wage based on job attributes.

Column: num.openings: 
Column description: Number of job openings associated with this listing.

Column: rr: 
Column description: .

Column: hired.past.w: 
Column description: Past wage of the hired worker.

Column: markup: 
Column description: Markup of hourly rate over profile rate.
    
## `event_study_hired_applicants.csv`

## `event_study_windows_hr_v_fp.csv`

## `event_study_windows.csv`

## `event_study_openings_raw.csv`

## `JobTitles.txt`
    
## `hires_country_composition.csv`
    
## `event_study_openings.csv`
        
# Replication

## Getting the data and code

A replicator will put a `.env` file in their `minimum_wage\writeup` folder. 
It will look like this:

```bash
GPG_PASSPHRASE='<password>'
project_name="minimum_wage"
DROPBOX_URL="<url of dropbox link hosting the data>"(base)
```

These values are used in a bash script that fetches the data, at [fetch_data.sh](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/fetch_data.sh)

```bash
#!/usr/bin/env bash
source writeup/.env
wget -O remote_data.tar.gz.gpg $DROPBOX_URL
gpg --batch --passphrase "$GPG_PASSPHRASE" --decrypt remote_data.tar.gz.gpg > data.tar.gz
tar -xvf data.tar.gz
```

## Data-fetching entries in the Makefile

```Makefile
../remote_data.tar.gz.gpg:
	cd .. && ./fetch_data.sh
	
fetch-data: ../remote_data.tar.gz.gpg
	echo "Fetching data"
```

## Running the code 
The least error-prone 
```bash 
$ cd writeup 
$ make docker
```


## Computational requirements
The computational requirements for reproducing this paper are minimal. 
It can be run on a modern laptop in less than 10 minutes, using only open-source software.

The machine details when I last ran it are: 
System info:
- OS: "Ubuntu 20.04.6 LTS"
- Processor:  11th Gen Intel(R) Core(TM) i7-11850H @ 2.50GHz, 16 cores
- Memory available: 31GB memory

The code was last run on 2024-01-03 15:16:41.

The Linux dependencies are mostly either for LaTeX or dependencies for various R packages.

#### Summary

Approximate time needed to reproduce the analyses on a standard 2023 desktop machine:

- [X] <10 minutes
- [ ] 10-60 minutes
- [ ] 1-2 hours
- [ ] 2-8 hours
- [ ] 8-24 hours
- [ ] 1-3 days
- [ ] 3-14 days
- [ ] > 14 days
- [ ] Not feasible to run on a desktop machine, as described below.

#### Details

## Description of programs/code

## Analytic files
The Makefile shows the mapping between each outcome in the paper and the analytic file that creates that outcome.

### License for Code

The code is licensed under an MIT license. 

### Details

## List of tables and programs

Given the convention used here where each R file generates a single table or figure, the purpose of each file is mostly self-documenting.  For convenience, each figure or table in the paper is listed here with the file that creates it. It also includes a link to the location in the main body where that file lives. 
Please refer to the Makefile at [Makefile](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/Makefile) for a list of each table and figure and the associated code and dependencies.

The provided code reproduces:

- [X] All numbers provided in the text of the paper
- [X] All tables and figures in the paper
- [X] Selected tables and figures in the paper, as explained and justified below.

## References

There are no references.

