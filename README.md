# Replication package
## Price Floors and Employer Preferences: Evidence from a Minimum Wage Experiment
by John Horton


This document describes the organization of code, data, and software associated with the project.
The code for this replication package is at:

[https://www.github.com/johnjosephhorton/minimum_wage.git](https://www.github.com/johnjosephhorton/minimum_wage.git)


## Overview
Although this guide has details, the project is largely self-documenting in the sense that the key recipes for building the project are captured in code. 
The key pieces for replicating this project are: 

1. A [Makefile](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/Makefile) that gives recipes for how each figure, table, and called-out number is constructed in the paper.

1. A [Dockerfile](Dockerfile) that describes the system set-up needed with respect to computing resources and packages. 

### File organization

The main directories are:
```
-writeup
-analysis
-computed_objects
-data_prep
```

The main writeup of the paper is in [`writeup/minimum wage.tex`](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/minimum_wage.tex).

The figures, tables, and parameter files (more on this later) are in `writeup/plots`, `writeup/tables` and `writeup/parameters`, respectively.

The code in [`analysis`]( https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis ) writes files to these locations. 
In the repository, these locations are empty by design.
When the project is built, these locations are populated with the necessary files. 

### Conventions
Each main figure and table is generated by its own stand-alone R file in `analysis` folder. 
The output that file creates (e.g., a table or plot) has the same name as the R file, with the type of output prepended. 
For example, the plot `any_exper.pdf` in `writeup/plots` is created by `plot_any_exper.R` in `analysis.`

### Building the paper
The building of this paper is orchestrated by software called ``[make](https://www.gnu.org/software/make/manual/make.html)''.
From the `writeup` folder at the command line, the user simply types `make minimum wage.pdf` which will then build the paper.

### A short make tutorial
A Makefile lists recipes for how a particular output used in the paper is constructed.
The Makefile entry for the any_exper.pdf figure looks like this: 
```
plots/any_exper.pdf: ../analysis/plot_any_exper.R
	cd ../analysis && Rscript plot_any_exper.R
```

Note that the target, or output is `plots/any_exper.pdf` 
After the colon is what this output depends on, code-wise, which is an R file in `analysis` called `plot_any_exper.R`.
The tabbed-in-line below is the recipe for how the target is actually constructed. 
In this case, it is just by running `Rscript` on `plot_any_exper.R.`

There is some code that is shared across multiple figures or tables. 
For example, `utilities_outcome_experimental_plots.R` has helper functions used in several plots.
To capture this dependency, there are entries in the Makefile that look like this: 

```
../analysis/plot_any_exper.R: ../analysis/utilities_outcome_experimental_plots.R
	touch ../analysis/plot_any_exper.R
```
The command `touch` here updates the timestamp of `analysis\plot_any_exper.R` which in turn 
would cause the recipe for `any_exper.pdf` to be re-run, as `plot_any_exper.R` is a dependency.

### Numbers called out in the writeup
There is also code that does not generate tables for figures, but instead generates "parameters."
These are numbers that are called out in the text but are generated automatically. 
For example, the `parameters/parameters.tex` file contains a line `\newcommand{\numTotal}{159,656}` that is related to the total allocation to the experiment.
If we look in `parameters.R` we see the corresponding code that creates this value.
```
addParam("\\numTotal", formatC(dim(df.mw.first)[1], big.mark = ","))
```

This `addParam` function comes from a personal R package called `JJHmisc` that is available on GitHub.

### Overall execution time on a modern laptop
From raw data to final PDF, it takes about 7 minutes to run. 

```
$ time make -B minimum_wage.pdf 

real	5m44.430s
user	7m28.013s
sys	4m42.827s
```

## Data Availability and Provenance Statements

### Provenance

This data comes from a large online labor market that conducted the experiment described in the paper. The data was pulled from the company's database using SQL. The experiment described in the paper was conducted by the platform by changing the experience for some subset of users.  The data used for this analysis is proprietary.

### Statement about Rights

- [X] I certify that the author(s) of the manuscript have legitimate access to and permission to use the data used in this manuscript. 

- [ ] I certify that the author(s) of the manuscript have documented permission to redistribute/publish the data contained within this replication package. Appropriate permission are documented in the [LICENSE.txt](LICENSE.txt) file.

### Summary of Availability

- [ ] All data **are** publicly available.
- [ ] Some data **cannot be made** publicly available.
- [X] **No data can be made** publicly available.

### Details on each Data Source

The data for this project are confidential, but may likely be obtained with Data Use Agreements with the data provider. 
The data provider itself chooses to remain anonymous.
As such, researchers interested in access to the data may contact John Horton at jjhorton@mit.edu. 
The author will assist with any reasonable replication attempts for two years following publication.
All data files are CSVs. 

## Dataset list
The paper uses the following datasets: 

    event_study_hired_applicants_with_past_avg_wage.csv
    Description: Individual-level details on the workers hired before and after platform-wide change.

    df_mw_first.csv
    Description: Job opening outcomes and treatment assignet from the experiment.

    event_study_hired_applicants.csv
    Description: Individual-level details on the workers hired before and after platform-wide change.

    event_study_windows_hr_v_fp.csv
    Description: 

    event_study_windows.csv
    Description: 

    event_study_openings_raw.csv
    Description: 

    JobTitles.txt
    Description: 

    hires_country_composition.csv
    Description: 

    event_study_openings.csv
    Description: All job openings posted before and after platform-wide change.

    rds2csv.R
    Description: 


## Codebooks

event_study_hired_applicants_with_past_avg_wage.csv
    

df_mw_first.csv
     
        
            Column: first_opening: 
            Column description: ID for the job opening.
        
            Column: opening_date: 
            Column description: The date when the job opening was posted.
        
            Column: num_organic_applications: 
            Column description: Number of applications received organically (i.e., not recruited).
        
            Column: level1: 
            Column description: High level category of the job, e.g., IT, sales, etc.
        
            Column: job_type: 
            Column description: Hourly or fixed price
        
            Column: employer: 
            Column description: ID for The company or individual offering the job.
        
            Column: total_charge: 
            Column description: The total amount paid to a hired worker
        
            Column: hours: 
            Column description: The number of hours-worked.
        
            Column: mean_wage_over_contract: 
            Column description: Average wage over the contract period.
        
            Column: average_feedback_to_contractor: 
            Column description: Average feedback score given to the contractors by the employer.
        
            Column: average_feedback_to_client: 
            Column description: Average feedback score given to the employer by the contractors.
        
            Column: hires: 
            Column description: Number of hires made from the job posting.
        
            Column: hired_past_y: 
            Column description: Productivity of hired worker in the past.
        
            Column: hired_pr: 
            Column description: Hired worker profile rate.
        
            Column: cell: 
            Column description: Experimental cell cell assignment.
        
            Column: kpo: 
            Column description: Indicator for Knowledge Process Outsourcing.
        
            Column: lwage.hat: 
            Column description: A predicted log-wage based on job attributes.
        
            Column: num.openings: 
            Column description: Number of job openings associated with this listing.
        
            Column: rr: 
            Column description: .
        
            Column: hired.past.w: 
            Column description: Past wage of the hired worker.
        
            Column: markup: 
            Column description: Markup of hourly rate over profile rate.
        
    

event_study_hired_applicants.csv
    

event_study_windows_hr_v_fp.csv
    

event_study_windows.csv
    

event_study_openings_raw.csv
    

JobTitles.txt
    

hires_country_composition.csv
    

event_study_openings.csv
    

rds2csv.R
    


## Mapping between analytic files and outcomes


    /home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv : 
    
     - first_stage.R
    
     - parameters_country_selection.R
    
     - realized_wage_distro.R
    
     - quantile_hours_worked.R
    
     - table_any_prior.R
    
     - avg_wages_by_cat.R
    
     - randomization_check.R
    
     - utilities_outcome_experimental_plots.R
    
     - parameters.R
    

    /home/john/topics/minimum_wage/etl/transformed/event_study_windows.csv : 
    
     - plot_application_event_study.R
    
     - parameters.R
    

    /home/john/topics/minimum_wage/etl/transformed/hires_country_composition.csv : 
    
     - parameters_country_selection.R
    
     - utilities_outcome_experimental_plots.R
    

    /home/john/topics/minimum_wage/etl/transformed/event_study_windows_hr_v_fp.csv : 
    
     - quantile_hours_worked.R
    
     - utilities_outcome_experimental_plots.R
    

# Replication

## Getting the data and code
To replicate the file, you need the actual data. 
Assuming you have permission, you will modify the following `.env` file placed in the root directory.
```
REPLICATION_LOCATION=~
OWNER=johnjosephhorton
CODE_REPO=minimum_wage
DATA_PATH=../etl/transformed/
COMPUTED_OBJECTS_PATH=../computed_objects/
DATA_URL=<<redaced>>
PASSPHRASE=<<redacted>>
```
The `DATA_URL` is a URL to all the data used in the paper, encrypted with a passphrase. 
The `PASSPHRASE` is a long string I used to encrypt the data. 

```
#!/bin/bash

projectname=minimum_wage
codeurl=https://john_horton_public.s3.amazonaws.com/path/to/minimum_wage.tar.gz
source .env

rm -rf /$REPLICATION_LOCATION/$projectname
echo "Moving replication location directory"
cd $REPLICATION_LOCATION
echo "Downloading code"
#git clone git@github.com:$OWNER/$CODE_REPO.git
wget $codeurl
tar -xvf $projectname.tar.gz  
cd $CODE_REPO
echo "Downloading data"
wget $DATA_URL
echo "Decrypting data"
gpg --batch --passphrase $PASSPHRASE replication_data.tar.gz.gpg
tar -xvf replication_data.tar.gz
echo "DATA_PATH=../mw_rep/" >> analysis/.env
echo "COMPUTED_OBJECTS_PATH=../mw_rep/" >> analysis/.env
echo "Constructing Dockercontainer from Dockerfile"
sudo docker build -t minimum_wage:v1 .
cd ..
mkdir replication_$replicationid
sudo docker run -v $(pwd)/replication:/replication minimum_wage:v1 bash \
-c "cp -r /minimum_wage/* /replication && \
    cd /replication/writeup && make minimum_wage.pdf"
```

## Computational requirements
The computational requirements for reproducing this paper are minimal. 
It can be run on a modern laptop in less than 10 minutes, using only open-source software.

The machine details when I last ran it are: 
System info:
- OS: "Ubuntu 20.04.6 LTS"
- Processor:  11th Gen Intel(R) Core(TM) i7-11850H @ 2.50GHz, 16 cores
- Memory available: 31GB memory

The code was last run on 2024-01-03 15:16:41.
```

The Linux dependencies are mostly either for LaTeX or dependencies for various R packages.


#### Summary

Approximate time needed to reproduce the analyses on a standard 2023 desktop machine:

- [X] <10 minutes
- [ ] 10-60 minutes
- [ ] 1-2 hours
- [ ] 2-8 hours
- [ ] 8-24 hours
- [ ] 1-3 days
- [ ] 3-14 days
- [ ] > 14 days
- [ ] Not feasible to run on a desktop machine, as described below.

#### Details

## Description of programs/code

## Analytic files

Name: [plot_any_exper.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_any_exper.R)

Data files used: []

Name: [first_stage.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/first_stage.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv']

Name: [plot_application_event_study.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_application_event_study.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/event_study_windows.csv']

Name: [parameters_country_selection.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/parameters_country_selection.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv', '/home/john/topics/minimum_wage/etl/transformed/hires_country_composition.csv']


Name: [realized_wage_distro.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/realized_wage_distro.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv']


Name: [plot_feedback.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_feedback.R)

Data files used: []


Name: [settings.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/settings.R)

Data files used: []


Name: [plot_organic_applications.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_organic_applications.R)

Data files used: []


Name: [quantile_hours_worked.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/quantile_hours_worked.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv', '/home/john/topics/minimum_wage/etl/transformed/event_study_windows_hr_v_fp.csv']


Name: [parameters_effects.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/parameters_effects.R)

Data files used: []


Name: [plot_hours_zero.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_hours_zero.R)

Data files used: []


Name: [plot_event_study_hourly_rate_hired.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_event_study_hourly_rate_hired.R)

Data files used: []


Name: [table_any_prior.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/table_any_prior.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv']


Name: [avg_wages_by_cat.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/avg_wages_by_cat.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv']


Name: [plot_follow_on_openings.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_follow_on_openings.R)

Data files used: []


Name: [plot_composition.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_composition.R)

Data files used: []


Name: [randomization_check.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/randomization_check.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv']


Name: [plot_fill_and_hours.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_fill_and_hours.R)

Data files used: []


Name: [utilities_outcome_experimental_plots.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/utilities_outcome_experimental_plots.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/event_study_windows_hr_v_fp.csv', '/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv', '/home/john/topics/minimum_wage/etl/transformed/hires_country_composition.csv']


Name: [plot_event_study_hired_admin.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_event_study_hired_admin.R)

Data files used: []


Name: [plot_did_all_outcomes.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/plot_did_all_outcomes.R)

Data files used: []


Name: [parameters.R](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/analysis/parameters.R)

Data files used: ['/home/john/topics/minimum_wage/etl/transformed/df_mw_first.csv', '/home/john/topics/minimum_wage/etl/transformed/event_study_windows.csv']


### License for Code

The code is licensed under an MIT license. 

## How I prepared data for replication 

```
mkdir /tmp/mw_rep
cd replication_tools
python AnalyticFiles.py
cd /tmp
tar -czvf replication_data.tar.gz mw_rep
export MY_PASSPHRASE=ice cream monkey cofee
gpg --batch --yes --passphrase $MY_PASSPHRASE -c replication_data.tar.gz
scp replication_data.tar.gz.gpg johnjhorton@johnjhorton.ssh.wpengine.net:/home/wpe-user/sites/johnjhorton/papers/replication_data.tar.gz.gpg
```

## Instructions to replicators

```
sudo docker run -v $(pwd):/v3 minimum_wage:v.8 bash -c "cp -r /minimum_wage/* /v3 && cd /v3/writeup && make minimum_wage.pdf"
```

## The `settings.R` file for changing out data locations
```
library(dotenv)

load_dot_env(".env")

DATA_PATH <<- Sys.getenv("DATA_PATH")
COMPUTED_OBJECTS_PATH <- Sys.getenv("COMPUTED_OBJECTS_PATH")

GetData <- function(csv_file){
    if (file.exists(paste0(COMPUTED_OBJECTS_PATH, csv_file))) {
        read.csv(paste0(COMPUTED_OBJECTS_PATH, csv_file))
    } else{
        read.csv(paste0(DATA_PATH, csv_file))
    }
}




```
The `.env` file in analytics 

```
git https://www.github.com/johnjosephhorton/minimum_wage.git
cd minimum_wage`
wget --no-check-certificate --no-proxy https://s3.amazonaws.com/john_horton_public/replication_data.tar.gz.gpg
gpg replication_data.tar.gz.gpg
tar -xvf replication_data.tar.gz
if [ -f analysis/.env ]; then
  mv analysis/.env analysis/.env_old
fi

```

``` 
DATA_PATH=<path to directory with data>
COMPUTED_OBJECTS_PATH=<path to directory with data>
```
5. 
```
sudo docker build -t minimum_wage:v1.0 .
sudo docker run -it minimum_wage:v1.0
```
5. Navigate to the writeup folder `cd writeup`
6. Run `make minimum_wage.pdf`

### Details

## List of tables and programs

Given the convention used here where each R file generates a single table or figure, the purpose of each file is mostly self-documenting.  For convenience, each figure or table in the paper is listed here with the file that creates it. It also includes a link to the location in the main body where that file lives. 
Please refer to the Makefile at [Makefile](https://www.github.com/johnjosephhorton/minimum_wage/blob/main/writeup/Makefile) for a list of each table and figure and the associated code and dependencies.

The provided code reproduces:

- [X] All numbers provided in the text of the paper
- [X] All tables and figures in the paper
- [X] Selected tables and figures in the paper, as explained and justified below.

## References

There are no references.

## Acknowledgements

Some content on this page was copied from [Hindawi](https://www.hindawi.com/research.data/#statement.templates). Other content was adapted from [Fort (2016)](https://doi.org/10.1093/restud/rdw057), Supplementary data, with the author's permission.